<html>
  <head>
    <script src="" type="text/javascript"></script>
    <script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app217.us.archive.org';v.server_ms=294;archive_analytics.send_pageview({});});</script>
    <script type="text/javascript" src="" charset="utf-8"></script>
    <script type="text/javascript" src="" charset="utf-8"></script>
    <title>Squid Users Guide</title>
  </head>
  <body bgcolor="#ffffff" link="#990000" vlink="#660000" alink="#660000">
    <!-- HEADLINE1 START-->
    <table width="100%" border="0">
      <tbody>
        <tr>
          <td bgcolor="9966ff">
            <font size="+3" color="FFFFFF">
              <b>More Configuration Details</b>
            </font>
          </td>
          <td bgcolor="BB99FF" width="5%">
            <font color="BB99FF">_</font>
          </td>
          <td bgcolor="DDCCFF" width="5%">
            <font color="DDCCFF">_</font>
          </td>
          <td bgcolor="F0E0FF" width="5%">
            <font color="F0E0FF">_</font>
          </td>
        </tr>
        <tr>
          <td bgcolor="9966ff" link="FFFFFF" valign="BASELINE">
            <font size="-1" color="#FFFFFF" acolor="#FFFFFF">
              <a href="/jwu.org/squid/Welcome.html">
                <img src="/jwu.org/squid/images/index.gif" align="BOTTOM" border="0">
                INDEX
              </a>
              <a href="/jwu.org/squid/initial/client.html">
                <img src="/jwu.org/squid/images/back.gif" align="BOTTOM" border="0">
                BACK
              </a>
              <a href="client.html">
                <img src="/jwu.org/squid/images/next.gif" align="BOTTOM" border="0">
                NEXT
              </a>
            </font>
          </td>
          <td bgcolor="BB99FF" width="5%">
            <font color="BB99FF">_</font>
          </td>
          <td bgcolor="DDCCFF" width="5%">
            <font color="DDCCFF">_</font>
          </td>
          <td bgcolor="F0E0FF" width="5%">
            <font color="F0E0FF">_</font>
          </td>
        </tr>
      </tbody>
    </table>
    <!--HEADLINE1 END-->
    <p>
      <!--HEADLINE2 START-->
      <table width="100%" border="0">
        <tbody>
          <tr>
            <td bgcolor="CCCCFF">
              <font size="+1" face="arial,helvetica">
                <b>Access controls</b>
              </font>
            </td>
            <td></td>
          </tr>
        </tbody>
      </table>
      <!--HEADLINE2 END-->
      <font face="arial,helvetica">Access control lists are the part of Squid's configuration that cause mostpeople problems. Some things are not necessarily immediately obvious,but they allow you to be very specific as to what to deny in a short form.</font>
    </p>
    <p>
      <font face="arial,helvetica">
        <font size="+1">
          <b>Basics</b>
        </font>
      </font>
    </p>
    <p>
      <font face="arial,helvetica">Stopping or allowing people from using you as a proxy server is only one ofthe functions of ACLs. ACLs are also used for cache hierarchies.Thus you will define an ACL first, and then deny or allow access to a functionof the cache. In 99% of cases this feature will be "http_access", which allowsor denies a web browser's to access you. We will use this as an example forall further cases, though principles apply to the other options (such as"icp_access").</font>
    </p>
    <p>
      <font face="arial,helvetica">
        Squid works it's way through the http_access list from top to bottom whendeciding which class you fall into, and also as to if you are denied orallowed access. Thus if you have a 
        <b>/24</b>
         (normally called a 
        <b>class C</b>
         ) network, and you want to allow only those machines accessto the web through the proxy, you would use the following (assuming that youwant the "class C" (properly a /24) 196.4.160.0 - 196.4.160.255 to have access:
      </font>
    </p>
    <hr>
    <font face="arial,helvetica">
      <pre>acl ourallowedhosts src 196.4.160.0/255.255.255.0acl all src 0.0.0.0/0.0.0.0http_access allow ourallowedhostshttp_access deny all</pre>
      <hr>
      <p>
        The "src" option on the first line is one of the options you can use todecide what acl the person is in. You can also choose based on things likethe current time, and the site that they are going to. For more optionshave a look at the 
        <i>/usr/local/squid/etc/squid.conf.default</i>
         filesquid installs on your system.
      </p>
      <p>
        If a user from 196.4.160.* connects using TCP and request a URL, Squid willwork it's way through the list of http_access lines (since it's a TCPconnection, the client is going to use the HTTP method to request theobject). It works through this list 
        <b>From TOP to BOTTOM,stopping after the FIRST match</b>
         to decide which one they are in.In this case, Squid will match on the first http_access line, Since the policy that matched is 
        <i>allow</i>,
        squid would proceed to allowtheir request.
      </p>
      <p>Re-writing the acl list above as follows:</p>
      <hr>
      <pre>acl ourallowedhosts src 196.4.160.0/255.255.255.0acl all src 0.0.0.0/0.0.0.0http_access deny allhttp_access allow ourallowedhosts</pre>
      <hr>
      <p>
        Will 
        <b>not</b>
         work, as squid will match on the first "http_access" line,and deny all users to connect.
      </p>
      <p></p>
      <p>
        <font size="+1">
          <b>More advanced options</b>
        </font>
      </p>
      <p>The default squid.conf has a few default settings in another form:</p>
      <p></p>
      <hr>
      <pre>acl manager proto cache_objectacl localhost src 127.0.0.1/255.255.255.255acl all src 0.0.0.0/0.0.0.0http_access deny manager !localhosthttp_access allow all</pre>
      <p>The "proto" field in the first line means that the acl blocks a specificprotocol, in this case the "cache_object" protocol. It could just as easilybe the "ftp" or "http" protocols. If you haven't heard of the "cache_object"protocol, don't worry - it's a squid-only protocol that returns informationto the sender as to how the cache is configured, or how it is running.It falls in the "http_access" section of the config as it is essentiallyan HTTP request to squid, but instead of connecting somewhere else to geta web page that it refers to, Squid just manufactures the info.</p>
      <p>The above example therefore says:If you get a connection trying to use the cache_object protocol (as definedin the manager acl), deny it, unless it's from the acl localhost. Thus aprogram running on the actual cache server can get info about squid'sinternal status, but not any machine on the outside. (remember that thecharacter "!" means NOT - so we are saying "deny manager NOT localhost"). Wealso allow client machines in any network access.</p>
      <p>
        <font size="+1">
          <b>Destination address based acls</b>
        </font>
      </p>
      <p>One example that people quite often need is to disable access to a listof sites that are "unappropriate". Squid is NOT optimised to do this fora large number of sites, but will handle a sufficient number for most peoplewithout much of a problem.</p>
      <pre>acl adults dstdomain playboy.com sex.comacl ourallowedhosts src 196.4.160.0/255.255.255.0acl all src 0.0.0.0/0.0.0.0http_access deny adultshttp_access allow ourallowedhostshttp_access deny all</pre>
       This means that machines requesting urls going to playboy.com or sex.comwill match on the first http_access deny line... when the http_access listsare checked all machines requesting adult sites (even if they are not ours)will be denied. If they pass that rule, we check if they are from our IPaddress range, if so, they are allowed access. If they aren't in our addressrange then they match the 
      <i>all</i>
       acl, and match the last http_access ruleand are denied. 
      <p>
        There is a problem with acls like this though - if the person specifiesthe machine (like www.playboy.com) by it's IP address, the acl'swon't match (they are looking for the DOMAIN in the acl...)so you need something that uses a 
        <i>dst</i>
         acl, and if it matches thatthrow it out...
      </p>
      <p></p>
      <hr>
      <font size="-1">
        <p>
          <i>
            The Squid Users guide is copyright Oskar Pearson 
            <a href="#">oskar@is.co.za</a>
          </i>
        </p>
      </font>
      <p>
        <font size="-1">
          <i>If you like the layout (I do), I can only thank William Meeand hope he forgives me for stealing it</i>
        </font>
      </p>
    </font>
  </body>
</html>